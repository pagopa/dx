"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8983],{4718:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(3309);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}},7853:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"getting-started/monorepository-setup","title":"Creating a Brand-New Mono-Repository on GitHub Using DX Tools","description":"This guide provides step-by-step instructions for creating and setting up a new","source":"@site/docs/getting-started/monorepository-setup.md","sourceDirName":"getting-started","slug":"/getting-started/monorepository-setup","permalink":"/dx/docs/getting-started/monorepository-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/pagopa/dx/tree/main/website/docs/getting-started/monorepository-setup.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_label":"Creating a Brand-New Mono-Repository on GitHub Using DX Tools","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/dx/docs/getting-started/"},"next":{"title":"Articles","permalink":"/dx/docs/articles/"}}');var i=t(3881),o=t(4718);const s={sidebar_label:"Creating a Brand-New Mono-Repository on GitHub Using DX Tools",sidebar_position:1},a="Creating a Brand-New Mono-Repository on GitHub Using DX Tools",d={},l=[{value:"Setup GitHub Repository",id:"setup-github-repository",level:2},{value:"Ensure an Appropriate Repository Access Control",id:"ensure-an-appropriate-repository-access-control",level:3},{value:"Define CODEOWNERS",id:"define-codeowners",level:3},{value:"Create Dot Files",id:"create-dot-files",level:3},{value:"Authenticating with GitHub for Terraform Operations",id:"authenticating-with-github-for-terraform-operations",level:3},{value:"Authenticate with GH CLI (recommended)",id:"authenticate-with-gh-cli-recommended",level:4},{value:"Authenticate with PAT token",id:"authenticate-with-pat-token",level:4},{value:"Create the GitHub PAT",id:"create-the-github-pat",level:5},{value:"Add a new repository to the GitHub PAT",id:"add-a-new-repository-to-the-github-pat",level:5},{value:"Link GitHub to Azure",id:"link-github-to-azure",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"creating-a-brand-new-mono-repository-on-github-using-dx-tools",children:"Creating a Brand-New Mono-Repository on GitHub Using DX Tools"})}),"\n",(0,i.jsx)(n.p,{children:"This guide provides step-by-step instructions for creating and setting up a new\nmono-repository on GitHub using DX tools."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Currently, only projects with a single environment powered by Azure are\nsupported. Additional tooling to support other scenarios is under development."})}),"\n",(0,i.jsx)(n.h2,{id:"setup-github-repository",children:"Setup GitHub Repository"}),"\n",(0,i.jsx)(n.p,{children:"Start by creating the repository on GitHub:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"gh repo create <org>/<repo-name> \\\n  --add-readme \\\n  --description <some-text> \\\n  --disable-wiki \\\n  --public \\\n  --clone\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then, follow these steps to complete the configuration."}),"\n",(0,i.jsx)(n.h3,{id:"ensure-an-appropriate-repository-access-control",children:"Ensure an Appropriate Repository Access Control"}),"\n",(0,i.jsx)(n.p,{children:"To ensure proper access control, follow these steps:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://pagopa.atlassian.net/wiki/search?text=github%20gestione%20utenze",children:"Grant access"}),"\nto your peers who need it."]}),"\n",(0,i.jsxs)(n.li,{children:["Provide ",(0,i.jsx)(n.code,{children:"Admin"})," access to the\n",(0,i.jsx)(n.a,{href:"https://pagopa.atlassian.net/wiki/search?text=github%20bot%20for%20projects",children:"GitHub bot user associated with your product"})]}),"\n",(0,i.jsxs)(n.li,{children:["Optionally: provide ",(0,i.jsx)(n.code,{children:"Admin"})," access to ",(0,i.jsx)(n.code,{children:"@engineering-team-devex"})," to ensure\nfuture support for DX tooling."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"define-codeowners",children:"Define CODEOWNERS"}),"\n",(0,i.jsxs)(n.p,{children:["Define a ",(0,i.jsx)(n.code,{children:"CODEOWNERS"})," file to manage repository ownership."]}),"\n",(0,i.jsxs)(n.p,{children:["See\n",(0,i.jsx)(n.a,{href:"https://help.github.com/en/articles/about-code-owners#example-of-a-codeowners-file",children:"https://help.github.com/en/articles/about-code-owners#example-of-a-codeowners-file"})]}),"\n",(0,i.jsx)(n.h3,{id:"create-dot-files",children:"Create Dot Files"}),"\n",(0,i.jsx)(n.p,{children:"Create the following dotfiles at the root of your repository:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".terraform-version"}),": Specify the Terraform version to use (typically\n",(0,i.jsx)(n.a,{href:"https://developer.hashicorp.com/terraform/install?product_intent=terraform",children:"the latest available"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".gitignore"}),": Add rules to manage Terraform files."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".pre-commit-config.yaml"}),": Define pre-commit hooks."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".editorconfig"}),": Enforce consistent coding styles."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".tflint.hcl"}),": Configure TFLint for Terraform linting."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".trivyignore"}),": Define rules for Trivy vulnerability scanning."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"authenticating-with-github-for-terraform-operations",children:"Authenticating with GitHub for Terraform Operations"}),"\n",(0,i.jsxs)(n.p,{children:["Changes to your repository via Terraform are applied from your local machine\nusing the ",(0,i.jsx)(n.code,{children:"terraform apply"})," command. This requires authentication with GitHub to\nensure that the changes are applied correctly."]}),"\n",(0,i.jsxs)(n.p,{children:["Before proceeding, ensure that you and your team have the\n",(0,i.jsx)(n.a,{href:"https://github.com/orgs/pagopa/repositories?type=source&q=eng-github-au",children:"required permissions"}),"\nto make changes to the repository."]}),"\n",(0,i.jsx)(n.p,{children:"Then, use one of the following methods to authenticate with GitHub:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Using the ",(0,i.jsx)(n.a,{href:"https://cli.github.com/",children:"GitHub CLI"})," (recommended)"]}),"\n",(0,i.jsx)(n.li,{children:"Using a Personal Access Token (PAT)"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"authenticate-with-gh-cli-recommended",children:"Authenticate with GH CLI (recommended)"}),"\n",(0,i.jsx)(n.p,{children:"Open your shell and run the command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\ngh auth login\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Follow the instructions on screen and you are ready to go."}),"\n",(0,i.jsx)(n.h4,{id:"authenticate-with-pat-token",children:"Authenticate with PAT token"}),"\n",(0,i.jsx)(n.p,{children:"To apply changes to your repository via Terraform, you can authenticate using a\nPersonal Access Token (PAT). A single PAT with the following permissions is\nrequired for all repositories managed through Terraform:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"read"}),": ",(0,i.jsx)(n.code,{children:"metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"read+write"}),": ",(0,i.jsx)(n.code,{children:"variables"}),", ",(0,i.jsx)(n.code,{children:"administration"}),", ",(0,i.jsx)(n.code,{children:"environments"}),", ",(0,i.jsx)(n.code,{children:"secrets"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If you already have a PAT configured with these permissions, you may skip the\nnext section."}),"\n",(0,i.jsx)(n.h5,{id:"create-the-github-pat",children:"Create the GitHub PAT"}),"\n",(0,i.jsx)(n.p,{children:"If you do not already have a Personal Access Token (PAT), follow these steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to your GitHub settings, under ",(0,i.jsx)(n.code,{children:"Developer settings"}),", and create a new\nfine-grained PAT:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Add these permissions:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"read"}),": ",(0,i.jsx)(n.code,{children:"metadata"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"read+write"}),": ",(0,i.jsx)(n.code,{children:"variables"}),", ",(0,i.jsx)(n.code,{children:"administration"}),", ",(0,i.jsx)(n.code,{children:"environments"}),", ",(0,i.jsx)(n.code,{children:"secrets"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.code,{children:"Only select repositories"})," and add the new repository."]}),"\n",(0,i.jsx)(n.li,{children:'Add a meaningful description like "PAT to manage GitHub locally via\nTerraform."'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["In your local environment, set the ",(0,i.jsx)(n.code,{children:"GITHUB_TOKEN"})," variable to the value of\nthe generated PAT."]}),"\n"]}),"\n",(0,i.jsx)(n.h5,{id:"add-a-new-repository-to-the-github-pat",children:"Add a new repository to the GitHub PAT"}),"\n",(0,i.jsx)(n.p,{children:"If you already have the PAT in both your GitHub account and your CLI profile,\nensure that the new repository is accessible from that PAT."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to your GitHub settings, under ",(0,i.jsx)(n.code,{children:"Developer settings"}),", and select the\nexisting fine-grained PAT."]}),"\n",(0,i.jsxs)(n.li,{children:["Under ",(0,i.jsx)(n.code,{children:"Only select repositories"}),", add your new repository."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["PATs have an expiration date.\n",(0,i.jsx)(n.a,{href:"https://pagopa.atlassian.net/wiki/search?text=github%20bot%20pat",children:"Be sure to renew them periodically"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"link-github-to-azure",children:"Link GitHub to Azure"}),"\n",(0,i.jsxs)(n.p,{children:["Follow GitHub best practices and connect your repository to Azure using the\n",(0,i.jsx)(n.a,{href:"https://registry.terraform.io/modules/pagopa-dx/azure-github-environment-bootstrap/azurerm/latest",children:"azure-github-environment-bootstrap"}),"\nTerraform module."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a folder named ",(0,i.jsx)(n.code,{children:"infra/bootstrapper"})," at the root of your repository."]}),"\n",(0,i.jsxs)(n.li,{children:["Define the module in this folder. Refer to the\n",(0,i.jsx)(n.a,{href:"https://registry.terraform.io/modules/pagopa-dx/azure-github-environment-bootstrap/azurerm/latest?tab=readme",children:"module README"}),"\nfor detailed instructions."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For more information, see the\n",(0,i.jsx)(n.a,{href:"https://pagopa.github.io/dx/blog/devex-azure-bootstrap-0.1-alpha",children:"related blog post"}),"\nand the ",(0,i.jsx)(n.a,{href:"/dx/docs/infrastructure/azure/azure-iam",children:"IAM Framework documentation"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);