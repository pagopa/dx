"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1315],{4718:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var o=t(3309);const i={},a=o.createContext(i);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:n},e.children)}},9325:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"articles/setting-up-devcontainer","title":"Setting up Development Containers","description":"What are Development Containers?","source":"@site/docs/articles/setting-up-devcontainer.md","sourceDirName":"articles","slug":"/articles/setting-up-devcontainer","permalink":"/dx/docs/articles/setting-up-devcontainer","draft":false,"unlisted":false,"editUrl":"https://github.com/pagopa/dx/tree/main/website/docs/articles/setting-up-devcontainer.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Setting up Development Containers"},"sidebar":"tutorialSidebar","previous":{"title":"Integrating Tracing in Azure NodeJS Applications","permalink":"/dx/docs/articles/azure-tracing"},"next":{"title":"Conventions","permalink":"/dx/docs/conventions/"}}');var i=t(3881),a=t(4718);const s={sidebar_label:"Setting up Development Containers"},r="Setting up Development Containers",d={},c=[{value:"What are Development Containers?",id:"what-are-development-containers",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Visual Studio Code",id:"visual-studio-code",level:4},{value:"Dev Container CLI",id:"dev-container-cli",level:4},{value:"Create your first Development Container",id:"create-your-first-development-container",level:2},{value:"Start the Development Container",id:"start-the-development-container",level:4},{value:"Visual Studio Code",id:"visual-studio-code-1",level:5},{value:"Dev Container CLI",id:"dev-container-cli-1",level:5},{value:"Adding the Node.js Feature",id:"adding-the-nodejs-feature",level:3},{value:"Test the Node.js Feature",id:"test-the-nodejs-feature",level:5},{value:"Execute <code>yarn install</code> on start",id:"execute-yarn-install-on-start",level:3},{value:"Customize the Development Container",id:"customize-the-development-container",level:3},{value:"Use a <code>Dockerfile</code> instead of a prebuilt image",id:"use-a-dockerfile-instead-of-a-prebuilt-image",level:3},{value:"Extra: Use a Development Container Template",id:"extra-use-a-development-container-template",level:3},{value:"Conclusion",id:"conclusion",level:3},{value:"Useful Links",id:"useful-links",level:4}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"setting-up-development-containers",children:"Setting up Development Containers"})}),"\n",(0,i.jsx)(n.h2,{id:"what-are-development-containers",children:"What are Development Containers?"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"A development container (or dev container for short) allows you to use a\ncontainer as a full-featured development environment. It can be used to run an\napplication, to separate tools, libraries, or runtimes needed for working with\na codebase, and to aid in continuous integration and testing. Dev containers\ncan be run locally or remotely, in a private or public cloud, in a variety of\nsupporting tools and editors."}),"\n",(0,i.jsxs)(n.p,{children:["\u2014 ",(0,i.jsx)(n.a,{href:"https://containers.dev/",children:"What are development Containers?"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Development Containers are useful for setting up a consistent development\nenvironment across different machines and sharing it with your team. They can\neven be used in your CI/CD pipeline to ensure that your code is built and tested\nin the same environment."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.p,{children:["You need to have docker installed on your machine. If you are on macOS or\nWindows, you can install ",(0,i.jsx)(n.a,{href:"https://rancherdesktop.io/",children:"Rancher Desktop"}),", which\nincludes all the tools you need to run ",(0,i.jsx)(n.code,{children:"docker"})," on your machine."]}),"\n",(0,i.jsx)(n.admonition,{title:"Recommended configuration for Rancher Desktop on macOS",type:"tip",children:(0,i.jsxs)(n.p,{children:["To achieve the best performance, we recommend using ",(0,i.jsx)(n.code,{children:"VZ"})," as the default ",(0,i.jsx)(n.em,{children:"Virtual\nMachine Type"})," and ",(0,i.jsx)(n.code,{children:"virtiofs"})," as the default ",(0,i.jsx)(n.em,{children:"File Sharing"})," method."]})}),"\n",(0,i.jsxs)(n.p,{children:["To build and run development containers, you need to have a\n",(0,i.jsx)(n.a,{href:"https://containers.dev/supporting",children:"Supporting Tool"})," installed on your machine.\nA supporting tool is a tool that can be used to build and run development\ncontainers. It can be a text editor, an IDE, a terminal, or a web-based tool."]}),"\n",(0,i.jsxs)(n.p,{children:["This guide will show you how to set up and use development containers with two\ndifferent supporting tools: ",(0,i.jsx)(n.strong,{children:"Visual Studio Code"})," and the ",(0,i.jsx)(n.strong,{children:"Dev Container\nCLI"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"visual-studio-code",children:"Visual Studio Code"}),"\n",(0,i.jsxs)(n.p,{children:["If you are using Visual Studio Code, you have to install the\n",(0,i.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers",children:"Dev Containers"}),"\nextension, which is the official extension to work with development containers."]}),"\n",(0,i.jsx)(n.h4,{id:"dev-container-cli",children:"Dev Container CLI"}),"\n",(0,i.jsxs)(n.p,{children:["If you are not using Visual Studio Code, you can still use development\ncontainers from your terminal using the ",(0,i.jsx)(n.code,{children:"devcontainer"})," command line tool. You\ncan install it using the following commands:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install -g @devcontainers/cli\n# Check if the installation was successful\ndevcontainer --version\n"})}),"\n",(0,i.jsx)(n.h2,{id:"create-your-first-development-container",children:"Create your first Development Container"}),"\n",(0,i.jsxs)(n.p,{children:["The core of a development container is a ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file. This file\ncontains the configuration of the development container, such as the base image,\nthe features to install, the post-start command, and customizations."]}),"\n",(0,i.jsxs)(n.p,{children:["To start, create a ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file in the root in ",(0,i.jsx)(n.code,{children:".devcontainer"}),"\ndirectory of your project."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  "image": "mcr.microsoft.com/devcontainers/base:debian"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This file defines a development container named ",(0,i.jsx)(n.code,{children:"My Development Container"})," based\non the ",(0,i.jsx)(n.code,{children:"mcr.microsoft.com/devcontainers/base:debian"})," image."]}),"\n",(0,i.jsx)(n.h4,{id:"start-the-development-container",children:"Start the Development Container"}),"\n",(0,i.jsx)(n.h5,{id:"visual-studio-code-1",children:"Visual Studio Code"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open the command palette (",(0,i.jsx)(n.code,{children:"Cmd + Shift + P"})," on macOS or ",(0,i.jsx)(n.code,{children:"Ctrl + Shift + P"})," on\nWindows/Linux)."]}),"\n",(0,i.jsxs)(n.li,{children:["Search for ",(0,i.jsx)(n.code,{children:"Dev Containers: Reopen in Container"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Visual Studio Code will build the development container and open a new window\ninside the container."}),"\n",(0,i.jsx)(n.h5,{id:"dev-container-cli-1",children:"Dev Container CLI"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Open a terminal in the root of your project."}),"\n",(0,i.jsx)(n.li,{children:"Run the following command:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# build and start the development container\ndevcontainer up --workspace-folder .\n# open a shell inside the container\ndevcontainer exec --workspace-folder . /bin/bash\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--workspace-folder"})," flag is used to specify the path to the folder that\ncontains the ",(0,i.jsx)(n.code,{children:".devcontainer"})," directory."]}),"\n",(0,i.jsx)(n.h3,{id:"adding-the-nodejs-feature",children:"Adding the Node.js Feature"}),"\n",(0,i.jsx)(n.p,{children:"Once you have created the development container, you can add features to it.\nFeatures are pre-built configurations that can be added to a development\ncontainer to install tools, libraries, or runtimes."}),"\n",(0,i.jsxs)(n.p,{children:["Let's install the Node.js feature to the development container. This feature\nwill install ",(0,i.jsx)(n.code,{children:"node"}),", ",(0,i.jsx)(n.code,{children:"npm"})," and ",(0,i.jsx)(n.code,{children:"yarn"})," at the specified version."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  "image": "mcr.microsoft.com/devcontainers/base:debian",\n  // highlight-start\n  "features": {\n    "ghcr.io/devcontainers/features/node:1": {\n      "version": "20.19.0"\n    }\n  }\n  // highlight-end\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can find a list of available features, official and community, in the\n",(0,i.jsx)(n.a,{href:"https://containers.dev/features",children:"Dev Container Features"})," page. Each feature has\nits own documentation that explains how to use it, check out the\n",(0,i.jsx)(n.a,{href:"https://github.com/devcontainers/features/tree/main/src/node",children:"Node.js feature documentation here"}),"\nto learn more about it."]}),"\n",(0,i.jsx)(n.h5,{id:"test-the-nodejs-feature",children:"Test the Node.js Feature"}),"\n",(0,i.jsxs)(n.p,{children:["Rebuild the development container and open a shell inside it. You can check if\n",(0,i.jsx)(n.code,{children:"node"}),", ",(0,i.jsx)(n.code,{children:"npm"}),", and ",(0,i.jsx)(n.code,{children:"yarn"})," are installed and at the correct version."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node --version\n# v20.19.0\nnpm --version\nyarn --version\n"})}),"\n",(0,i.jsxs)(n.admonition,{title:"How to rebuild a development container? In Visual Studio Code you can",type:"tip",children:[(0,i.jsxs)(n.p,{children:["rebuild the development container by running the\n",(0,i.jsx)(n.code,{children:"Dev Containers: Rebuild Container"})," command from the command palette. In the\nterminal, you can run the ",(0,i.jsx)(n.code,{children:"devcontainer up --workspace-folder ."})," command. :::"]}),(0,i.jsxs)(n.h3,{id:"execute-yarn-install-on-start",children:["Execute ",(0,i.jsx)(n.code,{children:"yarn install"})," on start"]}),(0,i.jsxs)(n.p,{children:["Once you have ",(0,i.jsx)(n.code,{children:"node"})," installed you may also want to run ",(0,i.jsx)(n.code,{children:"yarn install"})," when the\ndevelopment container starts."]}),(0,i.jsxs)(n.p,{children:["You can do this by adding a ",(0,i.jsx)(n.code,{children:"postStartCommand"})," to the ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  "image": "mcr.microsoft.com/devcontainers/base:debian",\n  // highlight-next-line\n  "postStartCommand": "yarn install",\n  "features": {\n    "ghcr.io/devcontainers/features/node:1": {\n      "version": "20.19.0"\n    }\n  }\n}\n'})}),(0,i.jsxs)(n.p,{children:["You can also run multiple commands by passing an object to ",(0,i.jsx)(n.code,{children:"postStartCommand"}),".\nThese commands will be executed in parallel."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  "image": "mcr.microsoft.com/devcontainers/base:debian",\n  // highlight-start\n  "postStartCommand": {\n    "yarn-install": "yarn install",\n    "greet": "echo \'Hello, from the development container!\'"\n  },\n  // highlight-end\n  "features": {\n    "ghcr.io/devcontainers/features/node:1": {\n      "version": "20.19.0"\n    }\n  }\n}\n'})}),(0,i.jsxs)(n.p,{children:["The development containers also support other lifecycle hooks like\n",(0,i.jsx)(n.code,{children:"preStartCommand"}),", ",(0,i.jsx)(n.code,{children:"postStartCommand"}),", ",(0,i.jsx)(n.code,{children:"preStopCommand"}),", and ",(0,i.jsx)(n.code,{children:"postStopCommand"}),".\nYou can learn more about them in the\n",(0,i.jsx)(n.a,{href:"https://containers.dev/implementors/spec/#lifecycle",children:"Dev Container Lifecycle Hooks"}),"\npage."]}),(0,i.jsx)(n.h3,{id:"customize-the-development-container",children:"Customize the Development Container"}),(0,i.jsxs)(n.p,{children:["You can customize the development container by adding customizations to the\n",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file. Customizations can be applied to the editor, the\nterminal, the shell, and the environment variables."]}),(0,i.jsxs)(n.p,{children:["One typical customization is to set up extensions and settings for Visual Studio\nCode. Let's configure the ",(0,i.jsx)(n.code,{children:"prettier"})," extension and set it as the default\nformatter."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  "image": "mcr.microsoft.com/devcontainers/base:debian",\n  "postStartCommand": "yarn install",\n  "features": {\n    "ghcr.io/devcontainers/features/node:1": {\n      "version": "20.19.0"\n    }\n  },\n  // highlight-start\n  "customizations": {\n    "vscode": {\n      "extensions": [\n        "esbenp.prettier-vscode"\n      ],\n      "settings": {\n        "editor.formatOnSave": true,\n        "editor.defaultFormatter": "esbenp.prettier-vscode"\n      }\n    }\n  }\n  // highlight-end\n}\n'})}),(0,i.jsxs)(n.p,{children:["Customizations are a great way to centralize the configuration of your\ndevelopment environment and share it with your team. You can learn more about\ncustomizations in the ",(0,i.jsx)(n.a,{href:"https://containers.dev/supporting",children:"Supporting Tool"})," page."]}),(0,i.jsxs)(n.admonition,{title:"Did you know? Some features includes customizations that are",type:"tip",children:[(0,i.jsxs)(n.p,{children:["automatically applied to the development container. For example the\n",(0,i.jsx)(n.a,{href:"https://github.com/devcontainers/features/tree/main/src/terraform",children:"Official Terraform Feature"}),"\nautomatically installs the ",(0,i.jsx)(n.code,{children:"hashicorp.terraform"})," VSC extension and sets up the\n",(0,i.jsx)(n.code,{children:"terraform"})," language server. :::"]}),(0,i.jsxs)(n.h3,{id:"use-a-dockerfile-instead-of-a-prebuilt-image",children:["Use a ",(0,i.jsx)(n.code,{children:"Dockerfile"})," instead of a prebuilt image"]}),(0,i.jsxs)(n.p,{children:["Sometimes you may want to use a custom Dockerfile to build the development\ncontainer instead of using a prebuilt image. You can do this by adding a ",(0,i.jsx)(n.code,{children:"build"}),"\nobject to the ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file."]}),(0,i.jsxs)(n.p,{children:["Let's create a custom Dockerfile that adds an alias for ",(0,i.jsx)(n.code,{children:"yarn"})," and use it to\nbuild the development container."]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:"Dockerfile"})," in the ",(0,i.jsx)(n.code,{children:".devcontainer"})," directory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",metastring:'title=".devcontainer/Dockerfile"',children:'FROM mcr.microsoft.com/devcontainers/base:debian\n\n# Add yarn alias\nRUN echo \'alias y="yarn"\' >> /etc/bash.bashrc\n\nCMD ["sleep", "infinity"]\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file to use the ",(0,i.jsx)(n.code,{children:"Dockerfile"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title=".devcontainer/devcontainer.json"',children:'{\n  "name": "My Development Container",\n  // highlight-start\n  "build": {\n    "dockerfile": "Dockerfile"\n  },\n  // highlight-end\n  "postStartCommand": "yarn install",\n  "features": {\n    "ghcr.io/devcontainers/features/node:1": {\n      "version": "20.19.0"\n    }\n  },\n  "customizations": {\n    "vscode": {\n      "extensions": [\n        "esbenp.prettier-vscode"\n      ],\n      "settings": {\n        "editor.formatOnSave": true,\n        "editor.defaultFormatter": "esbenp.prettier-vscode"\n      }\n    }\n  }\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Once you have updated the ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," file, you can rebuild the\ndevelopment container and open a shell inside it to test the newly added ",(0,i.jsx)(n.code,{children:"y"}),"\nalias."]}),"\n"]}),"\n"]}),(0,i.jsxs)(n.admonition,{title:"Docker Compose If you need to run multiple containers alongside the",type:"tip",children:[(0,i.jsxs)(n.p,{children:["development container, you can use ",(0,i.jsx)(n.strong,{children:"Docker Compose"})," to define the services\nthat should be started with the development container. This is useful when you\nneed to run backing services like databases, caches, or message brokers\nalongside the development container."]}),(0,i.jsxs)(n.p,{children:["A real-world example of this setup can be found in the\n",(0,i.jsx)(n.a,{href:"https://github.com/pagopa/io-messages/blob/main/.devcontainer/devcontainer.json",children:"pagopa/io-messages GitHub repository"}),"\nwhere the development container is started alongside a ",(0,i.jsx)(n.code,{children:"redis"}),", ",(0,i.jsx)(n.code,{children:"azurite"})," and\nother services using Docker Compose. :::"]}),(0,i.jsx)(n.h3,{id:"extra-use-a-development-container-template",children:"Extra: Use a Development Container Template"}),(0,i.jsxs)(n.p,{children:["You don't have to start from scratch when creating a development container. You\ncan use a ",(0,i.jsx)(n.a,{href:"https://containers.dev/templates",children:"template"})," to create a development\ncontainer with pre-built configurations."]}),(0,i.jsxs)(n.p,{children:["The PagoPA DX team maintain a\n",(0,i.jsx)(n.a,{href:"https://github.com/pagopa/dx/tree/main/.devcontainer/templates/node",children:"Node.js template"}),"\nthat you can use to create a development container for a Node.js project, that\nfollow the best practices and conventions listed in our Tech Radar."]}),(0,i.jsxs)(n.p,{children:["Since it is not published yet in the official registry, you need the ",(0,i.jsx)(n.strong,{children:"Dev\nContainer CLI"})," to use it. To use it follow these steps:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd path/to/your/project\ndevcontainer templates apply -t ghcr.io/pagopa/devcontainer-templates/node:1\n"})}),(0,i.jsxs)(n.p,{children:["This will scaffold a ",(0,i.jsx)(n.code,{children:"devcontainer.json"})," ready to work with ",(0,i.jsx)(n.code,{children:"node"}),", ",(0,i.jsx)(n.code,{children:"terraform"}),",\n",(0,i.jsx)(n.code,{children:"azure"})," and the other tools we use in our projects."]}),(0,i.jsx)(n.admonition,{title:"PagoPA's features and templates The DX team is working to develop custom",type:"tip",children:(0,i.jsxs)(n.p,{children:["features and templates that are not available in the official registry. You can\nfind them in the\n",(0,i.jsx)(n.a,{href:"https://github.com/pagopa/dx/tree/main/.devcontainer",children:"pagopa/dx GitHub repository"}),"."]})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(n.p,{children:["You now know the basics of setting up a development container. Check out the\nofficial ",(0,i.jsx)(n.a,{href:"https://containers.dev",children:"Dev Containers documentation"})," to learn more\nabout the features and customizations that you can add to your development\ncontainer to fit the need of your project."]}),"\n",(0,i.jsx)(n.h4,{id:"useful-links",children:"Useful Links"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/devcontainers/containers",children:"https://code.visualstudio.com/docs/devcontainers/containers"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers",children:"https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);