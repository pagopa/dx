'use strict';var fs=require('fs'),crypto=require('crypto');var s=".otel-session";function S(){let e=Date.now();fs.mkdirSync(s,{recursive:true});let n=`${s}/events.ndjson`;fs.existsSync(n)||fs.writeFileSync(n,"");let t=crypto.randomUUID();return {eventsFile:n,start:e,correlationId:t}}function E(e,n,t){let r=process.env.GITHUB_ENV;if(!r){console.error("GITHUB_ENV not defined; cannot export variables");return}fs.appendFileSync(r,`OTEL_EVENT_FILE=${e}
`),fs.appendFileSync(r,`OTEL_SESSION_START=${n}
`),fs.appendFileSync(r,`OTEL_CORRELATION_ID=${t}
`);let i=process.env.INPUT_CONNECTION_STRING;fs.appendFileSync(r,`APPLICATIONINSIGHTS_CONNECTION_STRING=${i}
`);}async function N(){try{let{eventsFile:e,start:n,correlationId:t}=S();E(e,n,t),console.log(`Telemetry session started. Events file: ${e} correlationId=${t}`);}catch(e){let n=e instanceof Error?e.message:String(e);console.error("setup-telemetry failed:",n),process.exit(1);}}N();