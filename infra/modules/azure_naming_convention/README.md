# DX - Common Variables Validation

This module generates output values that follow the naming conventions used in DX. It takes the following inputs:

- `prefix`: The prefix for the naming convention (e.g., io, dx, ...).
- `env_short`: A short identifier for the environment (e.g., “d”, "p", "u").
- `location`: The Azure region or location (e.g. italynorth, westeurope, ...).
- `domain`: (Optional) The domain name to include in the naming convention.
- `app_name`: The application name or identifier.
- `instance_number`: The instance number that can be between 1 and 99.

Based on these inputs, the module generates the following output values:

- `prefix`: A concatenation of the prefix, env_short, and location_short values, with domain included if provided. The format is:
`prefix-env_short-location_short-domain` (e.g. `dx-d-itn-test` if domain is test).
- `suffix`: The value of `instance_number`.
- `project`: A combination of prefix, env_short, and location_short values. The format is:
`prefix-env_short-location_short`.
- `names`: A map where the keys represent the resource types, and the values are the corresponding resource names, generated with the format:
`prefix-abbreviation-suffix`. The abbreviation is retrieved from the `local.resource_abbreviations` mapping.
  e.g.

  ```hcl
  {
    "app_service": "dx-d-itn-test-app-01",
    "blob_storage": "dx-d-itn-test-blob-01",
    "cosmos": "dx-d-itn-test-conmo-01",
    "virtual_network": "dx-d-itn-test-vnet-01"
  }
  ```

This module streamlines the process of generating consistent resource names based on a predefined naming structure, ensuring alignment with DX standards.

## How it works

This module have as input a list of environments that will be used to generate the output values.
Example:

```hcl
module "naming_convention" {
  source = "git::https://github.com/pagopa/dx-terraform-modules.git//infra/modules/azure_naming_convention?ref=main"

  environments = [
    {
      prefix          = "dx"
      env_short       = "d"
      location        = "italynorth"
      domain          = "test"
      app_name        = "app"
      instance_number = 1
    },
    {
      prefix          = "dx"
      env_short       = "p"
      location        = "italynorth"
      domain          = "test"
      app_name        = "app"
      instance_number = 2
    }
  ]
}
```

To generate the names, you need to use the `output` values generated by this module.
The output is composed of the following values:
> module.naming_convention.names.APP_PREFIX["INSTANCE_VALUE"]

Where:

- `APP_PREFIX` is the prefix of the application
- `INSTANCE_VALUE` is the instance string the corresponds to the instance number in the environment

Examples:

- `module.naming_convention.names.dx-d-itn-test-app.virtual_network["01"]` will return `dx-d-itn-test-app-vnet-01`
- `module.naming_convention.names.dx-p-itn-test-app.function_storage_account["02"]`will return `dxpitntestappstfn02`

<!-- markdownlint-disable -->
<!-- BEGIN_TF_DOCS -->
## Requirements

No requirements.

## Modules

No modules.

## Resources

No resources.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_environments"></a> [environments](#input\_environments) | List of values which are used to generate resource names and location short names for each environment. They are all mandatory except for domain, which should not be used only in the case of a resource used by multiple domains. | <pre>list(object({<br/>    prefix          = string<br/>    env_short       = string<br/>    location        = string<br/>    domain          = optional(string)<br/>    app_name        = string<br/>    instance_number = number<br/>  }))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_names"></a> [names](#output\_names) | n/a |
| <a name="output_prefix"></a> [prefix](#output\_prefix) | n/a |
| <a name="output_project"></a> [project](#output\_project) | n/a |
| <a name="output_suffix"></a> [suffix](#output\_suffix) | n/a |
<!-- END_TF_DOCS -->
