# DX - Azure Function App Module

![Terraform Module Downloads](https://img.shields.io/terraform/module/dm/pagopa-dx/azure-function-app/azurerm?logo=terraform&label=downloads&cacheSeconds=5000&link=https%3A%2F%2Fregistry.terraform.io%2Fmodules%2Fpagopa-dx%2Fazure-function-app%2Fazurerm%2Flatest)

This module deploys an Azure Function App with a strong opinionated configuration for networking, security, and deployment strategy. It is ideal for scenarios where you need your Function App to be private and securely integrated with Azure resources.

## Features

- **Function App**: Deploys a Linux-based Azure Function App supporting Node.js or Java runtimes
- **Staging Slot**: Includes a staging slot for zero-downtime deployments
- **App Service Plan**: Uses a Linux App Service Plan (can be created or reused)
- **Private Endpoints**: Ensures private connectivity for the Function App and its storage accounts
- **Subnet**: Manages subnet creation or reuse for outbound connectivity
- **Durable Functions**: Optional support for Durable Functions with dedicated storage
- **Monitoring**: Integrates with Application Insights and sets up health check alerts

## Use cases Comparison

| Use case  | Description                      | Staging Slot | Multi AZ | Worker Processes |
| --------- | -------------------------------- | ------------ | -------- | ---------------- |
| default   | Above average production tier    | Yes          | Yes      | 2                |
| high_load | High-performance production tier | Yes          | Yes      | 8                |

### Allowed Sizes

The SKU name is determined by the use case, but if you want to override it, you can set the `size` variable.
The allowed sizes are:

- P0v3
- P1v3
- P1mv3
- P2mv3
- P3mv3

## Usage Example

For a complete example, see the [examples/complete](https://github.com/pagopa-dx/terraform-azurerm-azure-function-app/tree/main/examples/complete) folder in this repository.

<!-- markdownlint-disable -->
<!-- BEGIN_TF_DOCS -->

## Requirements

| Name                                                               | Version           |
| ------------------------------------------------------------------ | ----------------- |
| <a name="requirement_azurerm"></a> [azurerm](#requirement_azurerm) | >= 4.8.0, < 5.0   |
| <a name="requirement_dx"></a> [dx](#requirement_dx)                | >= 0.6.0, < 1.0.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                               | Type        |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [azapi_resource.this](https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/resource)                                                                          | resource    |
| [azurerm_key_vault_access_policy.key_vault](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_access_policy)                               | resource    |
| [azurerm_linux_function_app.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app)                                              | resource    |
| [azurerm_linux_function_app_slot.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app_slot)                                    | resource    |
| [azurerm_monitor_metric_alert.function_app_health_check](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_metric_alert)                     | resource    |
| [azurerm_monitor_metric_alert.storage_account_health_check](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_metric_alert)                  | resource    |
| [azurerm_private_endpoint.function_sites](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                        | resource    |
| [azurerm_private_endpoint.st_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                               | resource    |
| [azurerm_private_endpoint.st_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                               | resource    |
| [azurerm_private_endpoint.st_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                              | resource    |
| [azurerm_private_endpoint.staging_function_sites](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                | resource    |
| [azurerm_private_endpoint.std_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                              | resource    |
| [azurerm_private_endpoint.std_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                              | resource    |
| [azurerm_private_endpoint.std_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                             | resource    |
| [azurerm_private_endpoint.std_table](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint)                                             | resource    |
| [azurerm_role_assignment.ca_storage_account_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                          | resource    |
| [azurerm_role_assignment.ca_storage_blob_data_owner](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                              | resource    |
| [azurerm_role_assignment.ca_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                       | resource    |
| [azurerm_role_assignment.durable_function_storage_blob_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)          | resource    |
| [azurerm_role_assignment.durable_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)         | resource    |
| [azurerm_role_assignment.durable_function_storage_table_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)         | resource    |
| [azurerm_role_assignment.function_storage_account_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                    | resource    |
| [azurerm_role_assignment.function_storage_blob_data_owner](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                        | resource    |
| [azurerm_role_assignment.function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                 | resource    |
| [azurerm_role_assignment.key_vault](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                                               | resource    |
| [azurerm_role_assignment.staging_durable_function_storage_blob_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)  | resource    |
| [azurerm_role_assignment.staging_durable_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource    |
| [azurerm_role_assignment.staging_durable_function_storage_table_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource    |
| [azurerm_role_assignment.staging_function_storage_account_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)            | resource    |
| [azurerm_role_assignment.staging_function_storage_blob_data_owner](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                | resource    |
| [azurerm_role_assignment.staging_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)         | resource    |
| [azurerm_service_plan.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/service_plan)                                                          | resource    |
| [azurerm_storage_account.durable_function](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account)                                        | resource    |
| [azurerm_storage_account.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account)                                                    | resource    |
| [azurerm_storage_account_network_rules.st_network_rules](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules)            | resource    |
| [azurerm_storage_account_network_rules.std_network_rules](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules)           | resource    |
| [azurerm_subnet.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet)                                                                      | resource    |
| [azurerm_private_dns_zone.function_app](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone)                                       | data source |
| [azurerm_private_dns_zone.storage_account_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone)                               | data source |
| [azurerm_private_dns_zone.storage_account_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone)                               | data source |
| [azurerm_private_dns_zone.storage_account_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone)                              | data source |
| [azurerm_private_dns_zone.storage_account_table](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone)                              | data source |
| [azurerm_virtual_network.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/virtual_network)                                                 | data source |

## Inputs

| Name                                                                                                                                                      | Description                                                                                                                                                                                            | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Default     | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | :------: |
| <a name="input_action_group_ids"></a> [action_group_ids](#input_action_group_ids)                                                                         | The ID of the Action Groups to invoke when an alert is triggered for the Function App.                                                                                                                 | `set(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `[]`        |    no    |
| <a name="input_app_service_plan_id"></a> [app_service_plan_id](#input_app_service_plan_id)                                                                | The ID of the App Service Plan where the Function App will be hosted. Leave null to create a new plan.                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_app_settings"></a> [app_settings](#input_app_settings)                                                                                     | A map of application settings for the Function App.                                                                                                                                                    | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a         |   yes    |
| <a name="input_application_insights_connection_string"></a> [application_insights_connection_string](#input_application_insights_connection_string)       | The connection string for Application Insights to enable monitoring and diagnostics.                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_application_insights_key"></a> [application_insights_key](#input_application_insights_key)                                                 | The instrumentation key for Application Insights to enable monitoring and diagnostics.                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_application_insights_sampling_percentage"></a> [application_insights_sampling_percentage](#input_application_insights_sampling_percentage) | The sampling percentage for Application Insights telemetry. Default is 5.                                                                                                                              | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `5`         |    no    |
| <a name="input_container_app_config"></a> [container_app_config](#input_container_app_config)                                                             | Configuration for the container app. If not null, a container app will be created.                                                                                                                     | <pre>object({<br/> environment_id = string<br/> user_assigned_identity_id = string<br/> image = string<br/> key_vault = object({<br/> id = string<br/> use_rbac = optional(bool, true)<br/> tenant_id = string<br/> })<br/> name = optional(string, "")<br/> active_revisions_mode = optional(string, "Single")<br/> target_port = optional(number, 80)<br/> min_replicas = optional(number, 1)<br/> max_replicas = optional(number, 1000)<br/> secrets = optional(map(object(<br/> {<br/> name = string<br/> key_vault_secret_id = string<br/> }<br/> )), {})<br/> })</pre> | `null`      |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                                                        | Values which are used to generate resource names and location short names. They are all mandatory except for domain, which should not be used only in the case of a resource used by multiple domains. | <pre>object({<br/> prefix = string<br/> env_short = string<br/> location = string<br/> domain = optional(string)<br/> app_name = string<br/> instance_number = string<br/> })</pre>                                                                                                                                                                                                                                                                                                                                                                                          | n/a         |   yes    |
| <a name="input_has_durable_functions"></a> [has_durable_functions](#input_has_durable_functions)                                                          | Set to true if the Function App hosts Durable Functions.                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`     |    no    |
| <a name="input_health_check_path"></a> [health_check_path](#input_health_check_path)                                                                      | The endpoint path where the health probe is exposed for the Function App.                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a         |   yes    |
| <a name="input_java_version"></a> [java_version](#input_java_version)                                                                                     | The version of Java to use for the Function App runtime.                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `17`        |    no    |
| <a name="input_node_version"></a> [node_version](#input_node_version)                                                                                     | The version of Node.js to use for the Function App runtime.                                                                                                                                            | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `20`        |    no    |
| <a name="input_private_dns_zone_resource_group_name"></a> [private_dns_zone_resource_group_name](#input_private_dns_zone_resource_group_name)             | The name of the resource group containing the private DNS zone for private endpoints. Defaults to the Virtual Network resource group.                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                                                                | The name of the resource group where resources will be deployed.                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a         |   yes    |
| <a name="input_size"></a> [size](#input_size)                                                                                                             | App Service Plan size. Allowed values: 'P0v3', 'P1v3', 'P2mv3', 'P3mv3'. If not set, it will be determined by the use_case.                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_slot_app_settings"></a> [slot_app_settings](#input_slot_app_settings)                                                                      | A map of application settings specific to the staging slot of the Function App.                                                                                                                        | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `{}`        |    no    |
| <a name="input_stack"></a> [stack](#input_stack)                                                                                                          | The runtime stack for the Function App. Allowed values are 'node' and 'java'.                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `"node"`    |    no    |
| <a name="input_sticky_app_setting_names"></a> [sticky_app_setting_names](#input_sticky_app_setting_names)                                                 | A list of application setting names that should remain constant and not be swapped between slots.                                                                                                      | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `[]`        |    no    |
| <a name="input_subnet_cidr"></a> [subnet_cidr](#input_subnet_cidr)                                                                                        | The CIDR block for the subnet used by the Function App for outbound connectivity. Mandatory if 'subnet_id' is not set.                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_subnet_id"></a> [subnet_id](#input_subnet_id)                                                                                              | The ID of the subnet where the Function App will be hosted. Leave null to create a new subnet.                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `null`      |    no    |
| <a name="input_subnet_pep_id"></a> [subnet_pep_id](#input_subnet_pep_id)                                                                                  | The ID of the subnet designated for private endpoints.                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a         |   yes    |
| <a name="input_subnet_service_endpoints"></a> [subnet_service_endpoints](#input_subnet_service_endpoints)                                                 | Enable service endpoints for the subnet used by the Function App. Set this only if dependencies do not use private endpoints.                                                                          | <pre>object({<br/> cosmos = optional(bool, false)<br/> storage = optional(bool, false)<br/> web = optional(bool, false)<br/> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                        | `null`      |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                             | A map of tags to assign to the resources.                                                                                                                                                              | `map(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | n/a         |   yes    |
| <a name="input_tls_version"></a> [tls_version](#input_tls_version)                                                                                        | Minimum TLS version for the App Service.                                                                                                                                                               | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `1.2`       |    no    |
| <a name="input_use_case"></a> [use_case](#input_use_case)                                                                                                 | Function App use case. Allowed values: 'default', 'high_load'.                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `"default"` |    no    |
| <a name="input_virtual_network"></a> [virtual_network](#input_virtual_network)                                                                            | Details of the virtual network where the subnet for the Function App will be created.                                                                                                                  | <pre>object({<br/> name = string<br/> resource_group_name = string<br/> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | n/a         |   yes    |

=======
| Name | Type |
|------|------|
| [azurerm_linux_function_app.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app) | resource |
| [azurerm_linux_function_app_slot.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_function_app_slot) | resource |
| [azurerm_monitor_metric_alert.function_app_health_check](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_metric_alert) | resource |
| [azurerm_monitor_metric_alert.storage_account_health_check](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_metric_alert) | resource |
| [azurerm_private_endpoint.function_sites](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.st_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.st_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.st_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.staging_function_sites](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.std_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.std_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.std_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_private_endpoint.std_table](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/private_endpoint) | resource |
| [azurerm_role_assignment.durable_function_storage_blob_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.durable_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.durable_function_storage_table_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.function_storage_account_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.function_storage_blob_data_owner](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_durable_function_storage_blob_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_durable_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_durable_function_storage_table_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_function_storage_account_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_function_storage_blob_data_owner](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_role_assignment.staging_function_storage_queue_data_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment) | resource |
| [azurerm_service_plan.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/service_plan) | resource |
| [azurerm_storage_account.durable_function](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account) | resource |
| [azurerm_storage_account.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account) | resource |
| [azurerm_storage_account_network_rules.st_network_rules](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules) | resource |
| [azurerm_storage_account_network_rules.std_network_rules](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules) | resource |
| [azurerm_subnet.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet) | resource |
| [azurerm_private_dns_zone.function_app](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone) | data source |
| [azurerm_private_dns_zone.storage_account_blob](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone) | data source |
| [azurerm_private_dns_zone.storage_account_file](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone) | data source |
| [azurerm_private_dns_zone.storage_account_queue](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone) | data source |
| [azurerm_private_dns_zone.storage_account_table](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/private_dns_zone) | data source |
| [azurerm_virtual_network.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/virtual_network) | data source |

## Inputs

| Name                                                                                                                                                      | Description                                                                                                                                                                                            | Type                                                                                                                                                                                | Default  | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- | :------: |
| <a name="input_action_group_ids"></a> [action_group_ids](#input_action_group_ids)                                                                         | The ID of the Action Groups to invoke when an alert is triggered for the Function App.                                                                                                                 | `set(string)`                                                                                                                                                                       | `[]`     |    no    |
| <a name="input_app_service_plan_id"></a> [app_service_plan_id](#input_app_service_plan_id)                                                                | The ID of the App Service Plan where the Function App will be hosted. Leave null to create a new plan.                                                                                                 | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_app_settings"></a> [app_settings](#input_app_settings)                                                                                     | A map of application settings for the Function App.                                                                                                                                                    | `map(string)`                                                                                                                                                                       | n/a      |   yes    |
| <a name="input_application_insights_connection_string"></a> [application_insights_connection_string](#input_application_insights_connection_string)       | The connection string for Application Insights to enable monitoring and diagnostics.                                                                                                                   | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_application_insights_key"></a> [application_insights_key](#input_application_insights_key)                                                 | The instrumentation key for Application Insights to enable monitoring and diagnostics.                                                                                                                 | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_application_insights_sampling_percentage"></a> [application_insights_sampling_percentage](#input_application_insights_sampling_percentage) | The sampling percentage for Application Insights telemetry. Default is 5.                                                                                                                              | `number`                                                                                                                                                                            | `5`      |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                                                        | Values which are used to generate resource names and location short names. They are all mandatory except for domain, which should not be used only in the case of a resource used by multiple domains. | <pre>object({<br/> prefix = string<br/> env_short = string<br/> location = string<br/> domain = optional(string)<br/> app_name = string<br/> instance_number = string<br/> })</pre> | n/a      |   yes    |
| <a name="input_has_durable_functions"></a> [has_durable_functions](#input_has_durable_functions)                                                          | Set to true if the Function App hosts Durable Functions.                                                                                                                                               | `bool`                                                                                                                                                                              | `false`  |    no    |
| <a name="input_health_check_path"></a> [health_check_path](#input_health_check_path)                                                                      | The endpoint path where the health probe is exposed for the Function App.                                                                                                                              | `string`                                                                                                                                                                            | n/a      |   yes    |
| <a name="input_java_version"></a> [java_version](#input_java_version)                                                                                     | The version of Java to use for the Function App runtime.                                                                                                                                               | `string`                                                                                                                                                                            | `17`     |    no    |
| <a name="input_node_version"></a> [node_version](#input_node_version)                                                                                     | The version of Node.js to use for the Function App runtime.                                                                                                                                            | `number`                                                                                                                                                                            | `20`     |    no    |
| <a name="input_private_dns_zone_resource_group_name"></a> [private_dns_zone_resource_group_name](#input_private_dns_zone_resource_group_name)             | The name of the resource group containing the private DNS zone for private endpoints. Defaults to the Virtual Network resource group.                                                                  | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                                                                | The name of the resource group where resources will be deployed.                                                                                                                                       | `string`                                                                                                                                                                            | n/a      |   yes    |
| <a name="input_slot_app_settings"></a> [slot_app_settings](#input_slot_app_settings)                                                                      | A map of application settings specific to the staging slot of the Function App.                                                                                                                        | `map(string)`                                                                                                                                                                       | `{}`     |    no    |
| <a name="input_stack"></a> [stack](#input_stack)                                                                                                          | The runtime stack for the Function App. Allowed values are 'node' and 'java'.                                                                                                                          | `string`                                                                                                                                                                            | `"node"` |    no    |
| <a name="input_sticky_app_setting_names"></a> [sticky_app_setting_names](#input_sticky_app_setting_names)                                                 | A list of application setting names that should remain constant and not be swapped between slots.                                                                                                      | `list(string)`                                                                                                                                                                      | `[]`     |    no    |
| <a name="input_subnet_cidr"></a> [subnet_cidr](#input_subnet_cidr)                                                                                        | The CIDR block for the subnet used by the Function App for outbound connectivity. Mandatory if 'subnet_id' is not set.                                                                                 | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_subnet_id"></a> [subnet_id](#input_subnet_id)                                                                                              | The ID of the subnet where the Function App will be hosted. Leave null to create a new subnet.                                                                                                         | `string`                                                                                                                                                                            | `null`   |    no    |
| <a name="input_subnet_pep_id"></a> [subnet_pep_id](#input_subnet_pep_id)                                                                                  | The ID of the subnet designated for private endpoints.                                                                                                                                                 | `string`                                                                                                                                                                            | n/a      |   yes    |
| <a name="input_subnet_service_endpoints"></a> [subnet_service_endpoints](#input_subnet_service_endpoints)                                                 | Enable service endpoints for the subnet used by the Function App. Set this only if dependencies do not use private endpoints.                                                                          | <pre>object({<br/> cosmos = optional(bool, false)<br/> storage = optional(bool, false)<br/> web = optional(bool, false)<br/> })</pre>                                               | `null`   |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                             | A map of tags to assign to the resources.                                                                                                                                                              | `map(any)`                                                                                                                                                                          | n/a      |   yes    |
| <a name="input_tier"></a> [tier](#input_tier)                                                                                                             | Resource tiers depending on workload. Allowed values are 's', 'm', 'l', 'xl'. Legacy values 'premium', 'standard', 'test' are also supported for backward compatibility.                               | `string`                                                                                                                                                                            | `"l"`    |    no    |
| <a name="input_tls_version"></a> [tls_version](#input_tls_version)                                                                                        | Minimum TLS version for the App Service.                                                                                                                                                               | `number`                                                                                                                                                                            | `1.2`    |    no    |
| <a name="input_virtual_network"></a> [virtual_network](#input_virtual_network)                                                                            | Details of the virtual network where the subnet for the Function App will be created.                                                                                                                  | <pre>object({<br/> name = string<br/> resource_group_name = string<br/> })</pre>                                                                                                    | n/a      |   yes    |

## Outputs

| Name                                                                                                     | Description                                                                                                                                                                                                      |
| -------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <a name="output_function_app"></a> [function_app](#output_function_app)                                  | Details of the Function App, including its resource group, service plan, and app-specific information such as ID, name, principal ID, and default hostname. Also includes details of the app slot if configured. |
| <a name="output_storage_account"></a> [storage_account](#output_storage_account)                         | Details of the primary storage account used by the Function App, including its ID and name.                                                                                                                      |
| <a name="output_storage_account_durable"></a> [storage_account_durable](#output_storage_account_durable) | Details of the storage account used for durable functions, including its ID and name. Returns null if not configured.                                                                                            |
| <a name="output_subnet"></a> [subnet](#output_subnet)                                                    | Details of the subnet used by the Function App, including its ID and name.                                                                                                                                       |

<!-- END_TF_DOCS -->
