name: Build GitHub Self-Hosted Runner

on:
  workflow_dispatch:
  # push:
  #   branches:
  #     - feat-create-new-docker-image-self-hosted-runner # for testing purposes

jobs:
  github_runner:
    uses: ./.github/workflows/docker_image_build.yaml
    name: GitHub Self-Hosted Runner
    permissions:
      contents: read
      actions: read
      id-token: write
    secrets: inherit
    with:
      dockerfile_path: './self-hosted-runner/Dockerfile'
      dockerfile_context: './self-hosted-runner'
      docker_image_name: 'dx-github-self-hosted-runner'
      image_description: 'DX GitHub Self-Hosted Runner'
      image_authors: 'DevEx'
      build_platforms: linux/amd64

  test:
    runs-on: ubuntu-latest
    needs: [github_runner]
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          fetch-depth: 0

      - name: Check Docker image
        id: check-docker-image
        run: |
          echo "Checking Docker image..."
          docker image ls
