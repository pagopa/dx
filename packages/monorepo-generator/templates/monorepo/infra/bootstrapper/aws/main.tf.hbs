module "core_values" {
  source  = "pagopa-dx/aws-core-values-exporter/aws"
  version = "~> {{ dxAwsCoreValuesExporterVersion }}"

  core_state = {
    bucket         = "{{ awsAccountId }}-terraform-state"
    key            = "{{ repoName }}.bootstrapper.{{ environment }}.tfstate"
    region         = "{{ awsRegion }}"
    dynamodb_table = "terraform-locks"
  }
}

module "aws_github_bootstrap" {
  source = "pagopa-dx/aws-github-environment-bootstrap/aws"
  version = "~> {{ dxAwsBootstrapperVersion }}"

  environment = local.environment

  repository = {
    name  = "{{ repoName }}"
  }

  vpc = {
    id              = module.core_values.vpc.id
    private_subnets = module.core_values.private_subnet_ids
  }

  github_private_runner = {
    personal_access_token = {
      ssm_parameter_name = module.core_values.personal_access_token_ssm_parameter_name
    }
  }

  oidc_provider_arn = module.core_values.oidc_provider_arn

  tags = local.tags
}
